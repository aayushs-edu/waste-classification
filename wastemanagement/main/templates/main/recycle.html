<html lang="en">
<head>
    <style>
      body {
        padding-bottom: 20px;
    }
    
    .navbar {
        margin-bottom: 20px;
    }
    
    button.green-button {
        padding: 10px 16px;
        background-color: rgba(76,186,111,255);
        border-color: rgba(76,186,111,255);
        border-style: solid;
        border-radius: 15px;
    }
    
    button.green-button:hover{
      cursor: pointer;
      background: transparent;
    }
    
    .slider-slow {
        animation-duration: 2s;
        animation-name: slide;
    }
    
    .slider-fast {
        animation-duration: 3s;
        animation-name: slide;
    }
    
    @keyframes slide {
        from {
            margin-top: 50%;
        }
        to {
            margin-top: 0%;
        }
    }
    
    h1.glow {
        text-shadow:1px 1px 10px rgba(76,186,111,255), 1px 1px 10px rgba(76,186,111,255);
    }
    
    
    .p1
    {
        position: absolute;
        font-size: 45px;
        text-align: center;
        top: 10%;
        width: 100%;
        font-family: 'Arial', sans-serif;
    }
    
    .c2
    {
        font-size: 30px;
        font-family: 'Arial', sans-serif;
        position: absolute;
        top: 20%;
        text-align: center;
        width: 100%;
    }
    
    .c3
    {
        font-size: 17;
        font-family: 'Arial', sans-serif;
        position: absolute;
        width: 120x;
        margin-left: 50%;
        top: 75%;
    }
    
    .c4
    {
        font-size: 17;
        font-family: 'Arial', sans-serif;
        position: absolute;
        left: 48.5%;
        top: 80%;
    }
    
    header h1{
    
        font-size: 35px;
        font-weight: 400;
        background-image: linear-gradient(to right, #00a2ff 0%, #ffffff 70%);
        font-family: 'Roboto', sans-serif;
        color: transparent;
        background-clip: text;
        -webkit-background-clip: text;
    
    }
    
    
    .center-hr {
        display: flex;
        justify-content: center;
        color: #fcfcfc;
        background-color: #ffffff;
        height: 2px;
    }
      
    .center-hr hr {
        width: 50%;
    }
    
    .navbar-nav.center2 {
        float:none;
        margin:0 auto;
        text-align: center;
    }
    #conversation {
        height: 500px;
        border: 1px solid #000;
        margin-bottom: 10px;
        overflow-y: scroll;
        background-color: #424755;
    }
    .container {
        display: flex;
    }

    .container textarea {
        flex: 1;
        margin-right: 10px;
        font-size: 16px;
    }

    .container input[type="submit"] {
        flex-shrink: 0;
        background: #10a37f;
        color: #fff;
        border: 0px;
        padding: 8px 16px;
        font-size: 14px;
        cursor: pointer;
    }
    .user-messages{
        width: 100%;
        padding: 10px;
        background: #343541;
        color: #fff;
    }
    .chatbot-messages{
        width: 100%;
        padding: 10px;
        background: #444655;
        color: #fff;
    }

    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
        <title>EcoSense</title>
</head>
<body style="background-color: #212529;">
    <nav class="navbar navbar-expand navbar-dark bg-dark" aria-label="Navigation Bar">
        <div class="container-fluid">
          <a class="navbar-brand" href="/">EcoSense</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample02" aria-controls="navbarsExample02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>
      <div style="text-align: center;">
        <div>
            <h1 class="glow" style="color: white; font-size: 10vh">EcoSense</h1>
            <br>
            <div class="card" style="width: 35rem; text-align: center; margin: auto;">
                <video id="myVidPlayer" autoplay playsinline style="pointer-events: none; transform: rotateY(180deg); -webkit-transform:rotateY(180deg); -moz-transform:rotateY(180deg);"></video>
                <div class="card-body">
                  <h5 class="card-title glow" style="font-size: 4vh">Instructions</h5>
                  <p class="card-text" style="font-size: 2vh">Hold any item up to the camera and take a picture by clicking "Capture." That's all!</p>
                  <button class="green-button" onclick="snapshot()" type="submit" style="text-decoration:none; font-size: 3vh; color: white;">
                    <b>Capture</b>
                </button>
                <div class="mycanvas">
               <h6>Captured snapshot</h6>
               <canvas style="align-items: center"></canvas>
           </div>
                </div>
              </div>
        
          </div>
        </div>

    
    <h1>Chatbot</h1>
    <div id="conversation">
        {% for message in conversation %}
            {% if message.role == 'user' %}
                <div class="user-messages"><p>You: {{ message.content }}</p></div>
            {% elif message.role == 'assistant' %}
                <div class="chatbot-messages"><p>ChatBot: {{ message.content }}</p></div>
            {% endif %}
        {% endfor %}
    </div>       
    <form id="chat-form" method="POST" action="{% url 'recycle' %}">
        {% csrf_token %}
        <div class="container">
            <textarea rows="3" class="centered-textarea" id="user-input" type="text" name="user_input" placeholder="Your message"></textarea>
            <input type="submit" value="Send">
        </div>
    </form>
    
    <script src="../js/home_page_events.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const conversation = document.getElementById('conversation');
    
            // Scroll conversation to the bottom
            conversation.scrollTop = conversation.scrollHeight;
    
            // Submit the form when the user presses Enter key
            userInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    chatForm.submit();
                }
            });
    
            // Focus on the user input field
            userInput.focus();
        });
    </script> 

    <script type="text/javascript">
        var canvas = document.querySelector("canvas");
        var context = canvas.getContext("2d");
        const video = document.querySelector('#myVidPlayer');
    
        //w-width,h-height
        var w, h;
        canvas.style.display = "none";
    
        //new
        function snapshot(){
            context.fillRect(0, 0, w, h);
            context.drawImage(video, 0, 0, w, h);
            canvas.style.display = "block";
                
            video.pause();
        }
    
        window.navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                video.onloadedmetadata = (e) => {
                    video.play();
    
                    //new
                    w = video.videoWidth;
                    h = video.videoHeight
    
                    canvas.width = w;
                    canvas.height = h;
                };
            })
            .catch(error => {
                alert('Enable camera to continue!');
            });
    </script>
    
    
</body>
</html>